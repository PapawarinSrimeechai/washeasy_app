{"version":3,"sources":["../../src/pages/top-up-machine2/top-up-machine2.module.ts","../../src/pages/top-up-machine2/top-up-machine2.ts"],"names":[],"mappings":"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","file":"1.js","sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { IonicPageModule } from 'ionic-angular';\r\nimport { TopUpMachine2Page } from './top-up-machine2';\r\nimport { HttpClientModule, HttpClient } from '@angular/common/http';\r\nimport { TranslateModule, TranslateLoader } from '@ngx-translate/core';\r\nimport { TranslateHttpLoader } from '@ngx-translate/http-loader';\r\nimport { IonicStorageModule } from '@ionic/storage';\r\n\r\nexport function HttpLoaderFactory(http: HttpClient) {\r\n  return new TranslateHttpLoader(http);\r\n}\r\n@NgModule({\r\n  declarations: [\r\n    TopUpMachine2Page,\r\n  ],\r\n  imports: [\r\n    IonicPageModule.forChild(TopUpMachine2Page),\r\n    HttpClientModule,\r\n    TranslateModule.forRoot({\r\n      loader: {\r\n        provide: TranslateLoader,\r\n        useFactory: HttpLoaderFactory,\r\n        deps: [HttpClient]\r\n      }\r\n    }),\r\n    IonicStorageModule.forRoot()\r\n  ],\r\n})\r\nexport class TopUpMachine2PageModule {}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/top-up-machine2/top-up-machine2.module.ts","import { Component } from '@angular/core';\r\nimport { IonicPage, NavController, NavParams, AlertController } from 'ionic-angular';\r\nimport { Token } from '@angular/compiler';\r\nimport { AngularFireDatabase, FirebaseObjectObservable, FirebaseListObservable} from \"angularfire2/database\";\r\nimport { MessageServiceProvider } from '../../providers/message-service/message-service';\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { Storage } from '@ionic/storage';\r\n\r\n/**\r\n * Generated class for the TopUpMachine2Page page.\r\n *\r\n * See http://ionicframework.com/docs/components/#navigation for more info\r\n * on Ionic pages and navigation.\r\n */\r\n\r\n@IonicPage()\r\n@Component({\r\n  selector: 'page-top-up-machine2',\r\n  templateUrl: 'top-up-machine2.html',\r\n})\r\nexport class TopUpMachine2Page {\r\n\r\n  topUpData = {} as {\r\n    token: string;\r\n    idWashing: string;\r\n    idDorm: string;\r\n  }\r\n  topUpData_$: FirebaseObjectObservable<any>;\r\n  topUpBalance = 0 as number;\r\n  topUpStatus = 1 as number;\r\n  flagTimeout = true;\r\n\r\n  constructor(public navCtrl: NavController, public navParams: NavParams, private afDatabase: AngularFireDatabase,\r\n    private msgService: MessageServiceProvider, private alertCtrl: AlertController\r\n    ,private translate: TranslateService,private storage: Storage) {\r\n      this.storage.get('lang').then((data)=>{\r\n        this.translate.setDefaultLang(data);\r\n        this.translate.use(data);\r\n      });\r\n      this.translate.setTranslation('en', {\r\n        title: 'Top up by coin machine',\r\n        thb: 'THB',\r\n        cancel:'Cancel',\r\n        ok:'OK',\r\n      });\r\n      this.translate.setTranslation('th', {\r\n        title: 'เติมเงินผ่านกล่องหยอดเหรียญ',\r\n        thb: 'บาท',\r\n        cancel:'ยกเลิก',\r\n        ok:'ตกลง',\r\n       });\r\n  }\r\n\r\n  ionViewDidLoad() {\r\n    console.log('ionViewDidLoad TopUpMachine2Page');\r\n    this.topUpData.token = this.navParams.get('token');\r\n    this.topUpData.idWashing = this.navParams.get('idWashing');\r\n    this.topUpData.idDorm = this.navParams.get('idDorm');\r\n    console.log(this.topUpData);\r\n    this.topUpData_$ = this.afDatabase.object(`washingMachine/${this.topUpData.idDorm}/machine/${this.topUpData.idWashing}/topUp`);\r\n      this.topUpData_$.subscribe(data=>{\r\n          this.topUpBalance = data.topUpBalance;\r\n          this.topUpStatus = data.topUpStatus;      \r\n      });\r\n      this.checkTimeout();\r\n    \r\n  }\r\n\r\n  async checkTimeout(){\r\n    if(this.flagTimeout=true){\r\n      this.flagTimeout=false;\r\n       setTimeout(() => {\r\n        if(this.topUpBalance==0 && this.topUpStatus==1){\r\n          this.msgService.topUpByBox(this.topUpData).subscribe(data=>{\r\n            console.log(data);\r\n            if(data.status==2){\r\n             \r\n            }\r\n          });\r\n          this.storage.get('lang').then((data)=>{\r\n            if(data=='en'){\r\n              this.showError2('Can not make transaction','Please coin within 10 seconds.');\r\n            }else if(data=='th'){\r\n              this.showError2('ไม่สามารถทำรายการได้','กรุณาหยอดเหรียญภายใน 10 วินาที');\r\n            }\r\n          });\r\n        }\r\n      }, 10000);\r\n    } \r\n  }\r\n\r\n  cancelTopUp(){\r\n    this.msgService.topUpByBox(this.topUpData).subscribe(data=>{\r\n      console.log(data);\r\n      if(data.status==2){\r\n       this.navCtrl.setRoot('HomePage');\r\n      }else{\r\n        this.navCtrl.setRoot('HomePage');\r\n      }\r\n    });\r\n  }\r\n\r\n  confirmTopUp(){\r\n    this.msgService.topUpByBox(this.topUpData).subscribe(data=>{\r\n      console.log(data);\r\n      this.storage.get('lang').then(value=>{\r\n        if(value=='en'){\r\n          if(data.status==1){\r\n             this.showError('Top up success',`Transaction code: ${data.message.timestamp} \\n :  ${data.message.priceByBox} THB`);\r\n           }else if(data.status==0){\r\n             this.showError('Error','Please contact the service provider for a refund.');\r\n           }\r\n        }else if(value=='th'){\r\n          if(data.status==1){\r\n            this.showError('เติมเงินสำเร็จ',`เลขที่อ้างอิง: ${data.message.timestamp} \\nจำนวนเงิน:  ${data.message.priceByBox}`);\r\n           }else if(data.status==0){\r\n            this.showError('เกิดข้อผิดพลาด','กรุณาติดต่อผู้ให้บริการเพื่อรับเงินคืน');\r\n           }\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  showError(_title, _subTitle) {\r\n    this.storage.get('lang').then((data)=>{\r\n      if(data=='en'){\r\n        let alert = this.alertCtrl.create({\r\n          title: _title,\r\n          subTitle: _subTitle,\r\n          buttons: [\r\n            {\r\n              text: 'OK',\r\n              handler: () => {\r\n                console.log('ok clicked');\r\n                this.navCtrl.setRoot('HomePage');\r\n              }\r\n            }\r\n          ]\r\n        });\r\n        alert.present();\r\n      }else if(data=='th'){\r\n        let alert = this.alertCtrl.create({\r\n        title: _title,\r\n        subTitle: _subTitle,\r\n        buttons: [\r\n          {\r\n            text: 'ตกลง',\r\n            handler: () => {\r\n              console.log('ok clicked');\r\n              this.navCtrl.setRoot('HomePage');\r\n            }\r\n          }\r\n        ]\r\n      });\r\n      alert.present();\r\n      }\r\n    });\r\n  }\r\n\r\n  showError2(_title, _subTitle) {\r\n    this.storage.get('lang').then((data)=>{\r\n      if(data=='en'){\r\n        let alert = this.alertCtrl.create({\r\n          title: _title,\r\n          subTitle: _subTitle,\r\n          buttons: [\r\n            {\r\n              text: 'OK',\r\n              handler: () => {\r\n                this.navCtrl.setRoot('HomePage');\r\n              }\r\n            }\r\n          ]\r\n        });\r\n        alert.present();\r\n      }else if(data=='th'){\r\n        let alert = this.alertCtrl.create({\r\n          title: _title,\r\n          subTitle: _subTitle,\r\n          buttons: [\r\n            {\r\n              text: 'ตกลง',\r\n              handler: () => {\r\n                this.navCtrl.setRoot('HomePage');\r\n              }\r\n            }\r\n          ]\r\n        });\r\n        alert.present();\r\n      }\r\n    });\r\n  \r\n  }\r\n\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/top-up-machine2/top-up-machine2.ts"],"sourceRoot":""}