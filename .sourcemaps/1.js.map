{"version":3,"sources":["../../src/pages/top-up-machine2/top-up-machine2.module.ts","../../src/pages/top-up-machine2/top-up-machine2.ts"],"names":[],"mappings":"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","file":"1.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { TopUpMachine2Page } from './top-up-machine2';\nimport { HttpClientModule, HttpClient } from '@angular/common/http';\nimport { TranslateModule, TranslateLoader } from '@ngx-translate/core';\nimport { TranslateHttpLoader } from '@ngx-translate/http-loader';\nimport { IonicStorageModule } from '@ionic/storage';\n\nexport function HttpLoaderFactory(http: HttpClient) {\n  return new TranslateHttpLoader(http);\n}\n@NgModule({\n  declarations: [\n    TopUpMachine2Page,\n  ],\n  imports: [\n    IonicPageModule.forChild(TopUpMachine2Page),\n    HttpClientModule,\n    TranslateModule.forRoot({\n      loader: {\n        provide: TranslateLoader,\n        useFactory: HttpLoaderFactory,\n        deps: [HttpClient]\n      }\n    }),\n    IonicStorageModule.forRoot()\n  ],\n})\nexport class TopUpMachine2PageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/top-up-machine2/top-up-machine2.module.ts","import { Component } from '@angular/core';\nimport { IonicPage, NavController, NavParams, AlertController } from 'ionic-angular';\nimport { Token } from '@angular/compiler';\nimport { AngularFireDatabase, FirebaseObjectObservable, FirebaseListObservable} from \"angularfire2/database\";\nimport { MessageServiceProvider } from '../../providers/message-service/message-service';\nimport { TranslateService } from '@ngx-translate/core';\nimport { Storage } from '@ionic/storage';\n\n/**\n * Generated class for the TopUpMachine2Page page.\n *\n * See http://ionicframework.com/docs/components/#navigation for more info\n * on Ionic pages and navigation.\n */\n\n@IonicPage()\n@Component({\n  selector: 'page-top-up-machine2',\n  templateUrl: 'top-up-machine2.html',\n})\nexport class TopUpMachine2Page {\n\n  topUpData = {} as {\n    token: string;\n    idWashing: string;\n    idDorm: string;\n  }\n  topUpData_$: FirebaseObjectObservable<any>;\n  topUpBalance = 0 as number;\n  topUpStatus = 1 as number;\n  flagTimeout = true;\n\n  constructor(public navCtrl: NavController, public navParams: NavParams, private afDatabase: AngularFireDatabase,\n    private msgService: MessageServiceProvider, private alertCtrl: AlertController\n    ,private translate: TranslateService,private storage: Storage) {\n      this.storage.get('lang').then((data)=>{\n        this.translate.setDefaultLang(data);\n        this.translate.use(data);\n      });\n      this.translate.setTranslation('en', {\n        title: 'Top up by coin machine',\n        thb: 'THB',\n        cancel:'Cancel',\n        ok:'OK',\n      });\n      this.translate.setTranslation('th', {\n        title: 'เติมเงินผ่านกล่องหยอดเหรียญ',\n        thb: 'บาท',\n        cancel:'ยกเลิก',\n        ok:'ตกลง',\n       });\n  }\n\n  ionViewDidLoad() {\n    console.log('ionViewDidLoad TopUpMachine2Page');\n    this.topUpData.token = this.navParams.get('token');\n    this.topUpData.idWashing = this.navParams.get('idWashing');\n    this.topUpData.idDorm = this.navParams.get('idDorm');\n    console.log(this.topUpData);\n    this.topUpData_$ = this.afDatabase.object(`washingMachine/${this.topUpData.idDorm}/machine/${this.topUpData.idWashing}/topUp`);\n      this.topUpData_$.subscribe(data=>{\n          this.topUpBalance = data.topUpBalance;\n          this.topUpStatus = data.topUpStatus;      \n      });\n      this.checkTimeout();\n    \n  }\n\n  async checkTimeout(){\n    if(this.flagTimeout=true){\n      this.flagTimeout=false;\n       setTimeout(() => {\n        if(this.topUpBalance==0 && this.topUpStatus==1){\n          this.msgService.topUpByBox(this.topUpData).subscribe(data=>{\n            console.log(data);\n            if(data.status==2){\n             \n            }\n          });\n          this.storage.get('lang').then((data)=>{\n            if(data=='en'){\n              this.showError2('Can not make transaction','Please coin within 10 seconds.');\n            }else if(data=='th'){\n              this.showError2('ไม่สามารถทำรายการได้','กรุณาหยอดเหรียญภายใน 10 วินาที');\n            }\n          });\n        }\n      }, 10000);\n    } \n  }\n\n  cancelTopUp(){\n    this.msgService.topUpByBox(this.topUpData).subscribe(data=>{\n      console.log(data);\n      if(data.status==2){\n       this.navCtrl.setRoot('HomePage');\n      }else{\n        this.navCtrl.setRoot('HomePage');\n      }\n    });\n  }\n\n  confirmTopUp(){\n    this.msgService.topUpByBox(this.topUpData).subscribe(data=>{\n      console.log(data);\n      this.storage.get('lang').then(value=>{\n        if(value=='en'){\n          if(data.status==1){\n             this.showError('Top up success',`Transaction code: ${data.message.timestamp} \\n :  ${data.message.priceByBox} THB`);\n           }else if(data.status==0){\n             this.showError('Error','Please contact the service provider for a refund.');\n           }\n        }else if(value=='th'){\n          if(data.status==1){\n            this.showError('เติมเงินสำเร็จ',`เลขที่อ้างอิง: ${data.message.timestamp} \\nจำนวนเงิน:  ${data.message.priceByBox}`);\n           }else if(data.status==0){\n            this.showError('เกิดข้อผิดพลาด','กรุณาติดต่อผู้ให้บริการเพื่อรับเงินคืน');\n           }\n        }\n      });\n    });\n  }\n\n  showError(_title, _subTitle) {\n    this.storage.get('lang').then((data)=>{\n      if(data=='en'){\n        let alert = this.alertCtrl.create({\n          title: _title,\n          subTitle: _subTitle,\n          buttons: [\n            {\n              text: 'OK',\n              handler: () => {\n                console.log('ok clicked');\n                this.navCtrl.setRoot('HomePage');\n              }\n            }\n          ]\n        });\n        alert.present();\n      }else if(data=='th'){\n        let alert = this.alertCtrl.create({\n        title: _title,\n        subTitle: _subTitle,\n        buttons: [\n          {\n            text: 'ตกลง',\n            handler: () => {\n              console.log('ok clicked');\n              this.navCtrl.setRoot('HomePage');\n            }\n          }\n        ]\n      });\n      alert.present();\n      }\n    });\n  }\n\n  showError2(_title, _subTitle) {\n    this.storage.get('lang').then((data)=>{\n      if(data=='en'){\n        let alert = this.alertCtrl.create({\n          title: _title,\n          subTitle: _subTitle,\n          buttons: [\n            {\n              text: 'OK',\n              handler: () => {\n                this.navCtrl.setRoot('HomePage');\n              }\n            }\n          ]\n        });\n        alert.present();\n      }else if(data=='th'){\n        let alert = this.alertCtrl.create({\n          title: _title,\n          subTitle: _subTitle,\n          buttons: [\n            {\n              text: 'ตกลง',\n              handler: () => {\n                this.navCtrl.setRoot('HomePage');\n              }\n            }\n          ]\n        });\n        alert.present();\n      }\n    });\n  \n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/top-up-machine2/top-up-machine2.ts"],"sourceRoot":""}